"use strict";var e=require("../../../common/vendor.js"),a=require("../../../common/js/mylogin.js");const t={data:()=>({userInfo:e.index.getStorageSync("user_info"),items:["月计划","周计划","年计划"],current:0,plans:[],pageIndex:1,numTotal:5,pageSize:5,horizontal:"right",vertical:"bottom",pattern:{color:"#7A7E83",backgroundColor:"#fff",selectedColor:"#007AFF",buttonColor:"#007aFF",iconColor:"#fff"},plandaterange:[Date.now(),Date.now()+5e8],planTypes:[{text:"月计划",value:0},{text:"周计划",value:1},{text:"年计划",value:2}],reTypes:[{text:"收入",value:0},{text:"支出",value:1}],parentIdRange:[],planFormData:{name:"",amountMoney:"",remark:"",planType:0,reType:0,startTime:"",endTime:"",parentId:""},planModifyFormData:{id:"",name:"",amountMoney:"",remark:"",planType:0,reType:0,startTime:"",endTime:"",parentId:""},planModifyDateRange:[],rules:{name:{rules:[{required:!0,errorMessage:"计划不能为空"}]},amountMoney:{rules:[{format:"number",errorMessage:"金额只能输入数字"}]}},swiperightoptions:[{text:"修改",style:{backgroundColor:"#007aff"}},{text:"删除",style:{backgroundColor:"#dd524d"}}]}),onLoad(){a.mylogin.checkLogin(!0),this.getPlanPage(1)},methods:{fabClick(){this.$refs.popup.open(),this.planFormData.startTime=this.plandaterange[0],this.planFormData.endTime=this.plandaterange[1]},onClickItem(e){this.current!==e.currentIndex&&(this.current=e.currentIndex,this.getPlanPage(1))},changePage(e){this.getPlanPage(e.current)},getPlanDetail(a){e.index.navigateTo({url:"plandetail/plandetail?id="+a})},getPlanPage(a){var t=this;e.index.showLoading({title:"数据查询中……"}),t.plans=[],e.index.request({url:"/api/ika/v1/plan/findbypage",method:"POST",timeout:3e3,header:{Authorization:t.userInfo.token},data:{uId:t.userInfo.id,pageIndex:a,pageSize:5,planType:t.current},success:a=>{if(e.index.hideLoading(),1===a.data.status){t.numTotal=a.data.data.totalNum;for(var n=a.data.data.planList,o=0;o<n.length;o++)t.plans.push(n[o])}else e.index.showToast({title:a.data.message,icon:"error",duration:2e3})},fail:a=>{e.index.hideLoading(),e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3})}})},submitPlan(a){var t=this;t.$refs[a].validate().then((a=>{e.index.request({url:"/api/ika/v1/plan/add",method:"POST",timeout:3e3,header:{Authorization:t.userInfo.token},data:t.planFormData,success:a=>{1===a.data.status?(e.index.showToast({title:a.data.message,icon:"success",duration:1e3}),t.$refs.popup.close(),t.getPlanPage(1)):e.index.showToast({title:a.data.message,icon:"error",duration:2e3})},fail:a=>{e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3})}})})).catch((a=>{e.index.showToast({title:a[0].errorMessage,icon:"fail",duration:2e3}),console.log("err",a)}))},selectPlanDate(e){this.planFormData.startTime=e[0],this.planFormData.endTime=e[1]},selectModifyPlanDate(e){this.planModifyFormData.startTime=e[0],this.planModifyFormData.endTime=e[1]},getParentData(){var a=this;e.index.request({url:"/api/ika/v1/plan/getnotfinish",method:"GET",timeout:3e3,header:{Authorization:a.userInfo.token},success:t=>{1===t.data.status?a.parentIdRange=t.data.data:e.index.showToast({title:t.data.message,icon:"error",duration:2e3})},fail:a=>{e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3})}})},changeParentId(e){this.planFormData.parentId=e},changeModifyParentId(e){this.planModifyFormData.parentId=e},swipeBindClick(e,a){"修改"===e.content.text?this.modifyPlan(a):"删除"===e.content.text&&this.deletePlan(a.id)},modifyPlan(e){var a=this;a.planModifyFormData={id:e.id,name:e.name,amountMoney:e.amountMoney,remark:e.remark,planType:e.planType,reType:e.reType,startTime:e.startTime.substring(0,10),endTime:e.endTime.substring(0,10),parentId:e.parentId},a.planModifyDateRange=[],a.planModifyDateRange.push(a.planModifyFormData.startTime),a.planModifyDateRange.push(a.planModifyFormData.endTime),a.getParentData(),a.$refs.modifyPlan.open()},submitModifyPlan(a){var t=this;t.$refs[a].validate().then((a=>{e.index.showLoading({title:"数据修改中……"}),e.index.request({url:"/api/ika/v1/plan/modify",method:"POST",timeout:3e3,header:{Authorization:t.userInfo.token},data:t.planModifyFormData,success:a=>{e.index.hideLoading(),1===a.data.status?(e.index.showToast({title:a.data.message,icon:"success",duration:2e3}),t.$refs.modifyPlan.close(),t.getPlanPage(1)):e.index.showToast({title:a.data.message,icon:"error",duration:2e3})},fail:a=>{e.index.hideLoading(),e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3})}})})).catch((a=>{e.index.showToast({title:a[0].errorMessage,icon:"fail",duration:2e3}),console.log("err",a)}))},deletePlan(a){e.index.request({url:"/api/ika/v1/plan/delete?id="+a,method:"DELETE",timeout:3e3,header:{Authorization:this.userInfo.token},success:a=>{1===a.data.status?(e.index.showToast({title:a.data.message,icon:"success",duration:2e3}),this.getPlanPage(1)):e.index.showToast({title:a.data.message,icon:"error",duration:2e3})},fail:a=>{e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3})}})}}};if(!Array){(e.resolveComponent("uni-segmented-control")+e.resolveComponent("uni-tag")+e.resolveComponent("uni-card")+e.resolveComponent("uni-swipe-action-item")+e.resolveComponent("uni-swipe-action")+e.resolveComponent("uni-pagination")+e.resolveComponent("uni-fab")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni_modules/uni-segmented-control/components/uni-segmented-control/uni-segmented-control.js")+(()=>"../../../uni_modules/uni-tag/components/uni-tag/uni-tag.js")+(()=>"../../../uni_modules/uni-card/components/uni-card/uni-card.js")+(()=>"../../../uni_modules/uni-swipe-action/components/uni-swipe-action-item/uni-swipe-action-item.js")+(()=>"../../../uni_modules/uni-swipe-action/components/uni-swipe-action/uni-swipe-action.js")+(()=>"../../../uni_modules/uni-pagination/components/uni-pagination/uni-pagination.js")+(()=>"../../../uni_modules/uni-fab/components/uni-fab/uni-fab.js")+(()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();var n=e._export_sfc(t,[["render",function(a,t,n,o,i,r){return e.e({a:e.o(r.onClickItem),b:e.p({current:i.current,values:i.items}),c:0===i.current},0===i.current?{d:e.f(i.plans,((a,t,n)=>({a:"7d6189af-4-"+n+",7d6189af-3-"+n,b:e.p({mark:!0,text:a.amountMoney,type:0===a.reType?"primary":"error",size:"mini"}),c:e.t(a.remark),d:e.o((e=>r.getPlanDetail(a.id))),e:"7d6189af-3-"+n+",7d6189af-2-"+n,f:e.p({title:a.name,"sub-title":a.code,extra:a.reType_Desc}),g:a.id,h:e.o((e=>r.swipeBindClick(e,a)),a.id),i:"7d6189af-2-"+n+",7d6189af-1-"+n,j:"7d6189af-1-"+n}))),e:e.p({"right-options":i.swiperightoptions,show:"none","auto-close":!0}),f:e.o(r.changePage),g:e.p({"show-icon":!0,title:"分页",total:i.numTotal,current:i.pageIndex,pageSize:i.pageSize})}:{},{h:1===i.current},1===i.current?{i:e.f(i.plans,((a,t,n)=>({a:"7d6189af-9-"+n+",7d6189af-8-"+n,b:e.p({mark:!0,text:a.amountMoney,type:0===a.reType?"primary":"error",size:"mini"}),c:e.t(a.remark),d:e.o((e=>r.getPlanDetail(a.id))),e:"7d6189af-8-"+n+",7d6189af-7-"+n,f:e.p({title:a.name,"sub-title":a.code,extra:a.reType_Desc}),g:a.id,h:e.o((e=>r.swipeBindClick(e,a)),a.id),i:"7d6189af-7-"+n+",7d6189af-6-"+n,j:"7d6189af-6-"+n}))),j:e.p({"right-options":i.swiperightoptions,show:"none","auto-close":!0}),k:e.o(r.changePage),l:e.p({"show-icon":!0,title:"分页",total:i.numTotal,current:i.pageIndex,pageSize:i.pageSize})}:{},{m:2===i.current},2===i.current?{n:e.f(i.plans,((a,t,n)=>({a:"7d6189af-14-"+n+",7d6189af-13-"+n,b:e.p({mark:!0,text:a.amountMoney,type:0===a.reType?"primary":"error",size:"mini"}),c:e.t(a.remark),d:e.o((e=>r.getPlanDetail(a.id))),e:"7d6189af-13-"+n+",7d6189af-12-"+n,f:e.p({title:a.name,"sub-title":a.code,extra:a.reType_Desc}),g:a.id,h:e.o((e=>r.swipeBindClick(e,a)),a.id),i:"7d6189af-12-"+n+",7d6189af-11-"+n,j:"7d6189af-11-"+n}))),o:e.p({"right-options":i.swiperightoptions,show:"none","auto-close":!0}),p:e.o(r.changePage),q:e.p({"show-icon":!0,title:"分页",total:i.numTotal,current:i.pageIndex,pageSize:i.pageSize})}:{},{r:e.sr("fab","7d6189af-16"),s:e.o(r.fabClick),t:e.p({pattern:i.pattern,horizontal:i.horizontal,vertical:i.vertical}),v:e.o((e=>i.planFormData.name=e)),w:e.p({placeholder:"请输入计划名",modelValue:i.planFormData.name}),x:e.p({label:"计划名",required:!0,name:"name"}),y:e.o((e=>i.planFormData.reType=e)),z:e.p({mode:"button",localdata:i.reTypes,modelValue:i.planFormData.reType}),A:e.p({label:"收支",required:!0}),B:e.o((e=>i.planFormData.planType=e)),C:e.p({mode:"button",localdata:i.planTypes,modelValue:i.planFormData.planType}),D:e.p({label:"计划类型",required:!0}),E:e.o((e=>i.planFormData.amountMoney=e)),F:e.p({placeholder:"请输入金额",modelValue:i.planFormData.amountMoney}),G:e.p({label:"金额",required:!0,name:"amountMoney"}),H:e.o(r.selectPlanDate),I:e.o((e=>i.plandaterange=e)),J:e.p({type:"daterange",modelValue:i.plandaterange}),K:e.p({label:"日期",required:!0,name:"dateform"}),L:e.o(r.getParentData),M:e.o(r.changeParentId),N:e.o((e=>i.planFormData.parentId=e)),O:e.p({localdata:i.parentIdRange,modelValue:i.planFormData.parentId}),P:e.p({label:"父级",name:"parentId"}),Q:e.o((e=>i.planFormData.remark=e)),R:e.p({type:"textarea",placeholder:"请输入备注",modelValue:i.planFormData.remark}),S:e.p({label:"备注",name:"remark"}),T:e.sr("valiForm","7d6189af-18,7d6189af-17"),U:e.p({rules:i.rules,modelValue:i.planFormData}),V:e.o((e=>r.submitPlan("valiForm"))),W:e.sr("popup","7d6189af-17"),X:e.p({type:"bottom","background-color":"#fff"}),Y:e.o((e=>i.planModifyFormData.name=e)),Z:e.p({placeholder:"请输入计划名",modelValue:i.planModifyFormData.name}),aa:e.p({label:"计划名",required:!0,name:"name"}),ab:e.o((e=>i.planModifyFormData.reType=e)),ac:e.p({mode:"button",localdata:i.reTypes,modelValue:i.planModifyFormData.reType}),ad:e.p({label:"收支",required:!0}),ae:e.o((e=>i.planModifyFormData.planType=e)),af:e.p({mode:"button",localdata:i.planTypes,modelValue:i.planModifyFormData.planType}),ag:e.p({label:"计划类型",required:!0}),ah:e.o((e=>i.planModifyFormData.amountMoney=e)),ai:e.p({placeholder:"请输入金额",modelValue:i.planModifyFormData.amountMoney}),aj:e.p({label:"金额",required:!0,name:"amountMoney"}),ak:e.o(r.selectModifyPlanDate),al:e.o((e=>i.planModifyDateRange=e)),am:e.p({type:"daterange",modelValue:i.planModifyDateRange}),an:e.p({label:"日期",required:!0,name:"dateform"}),ao:e.o(r.changeModifyParentId),ap:e.o((e=>i.planModifyFormData.parentId=e)),aq:e.p({localdata:i.parentIdRange,modelValue:i.planModifyFormData.parentId}),ar:e.p({label:"父级",name:"parentId"}),as:e.o((e=>i.planModifyFormData.remark=e)),at:e.p({type:"textarea",placeholder:"请输入备注",modelValue:i.planModifyFormData.remark}),av:e.p({label:"备注",name:"remark"}),aw:e.sr("valiModifyForm","7d6189af-34,7d6189af-33"),ax:e.p({rules:i.rules,modelValue:i.planModifyFormData}),ay:e.o((e=>r.submitModifyPlan("valiModifyForm"))),az:e.sr("modifyPlan","7d6189af-33"),aA:e.p({type:"left","background-color":"#fff"})})}]]);wx.createPage(n);
