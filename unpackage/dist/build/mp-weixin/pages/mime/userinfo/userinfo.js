"use strict";var e=require("../../../common/vendor.js");const o={data:()=>({value:"请填写",sex:[{id:0,name:"男"},{id:1,name:"女"},{id:2,name:"不明"}],index:0,date:"请填写",avater:"",description:"",url:"",nickName:"",mobile:"",headimg:"",email:"",fabcontent:[{iconPath:"/static/images/icon/modifypwd.png",selectedIconPath:"/static/images/icon/modifypwd.png",text:"改密",active:!1},{iconPath:"/static/images/icon/loginout.png",selectedIconPath:"/static/images/icon/loginout.png",text:"退登",active:!1}],fabPattern:{backgroundColor:"#fff",buttonColor:"#000000",iconColor:"#fff"},userInfo:e.index.getStorageSync("user_info"),colorDefault:"#b4b4b4",colorFocusColor:"#66ffff",inputColorConfigToUserName:{color:"#000000",disableColor:"#eee",borderColor:"#b4b4b4"},inputColorConfigToPassWord:{color:"#000000",disableColor:"#eee",borderColor:"#b4b4b4"},passnew:"",pascheck:""}),onLoad(){this.getUserInfo01()},methods:{fabtrigger(e){"改密"===e.item.text?this.modifyPassword():"退登"===e.item.text&&this.loginOut()},modifyPassword(){this.$refs.popup.open()},loginOut(){var o=this;e.index.showModal({title:"敬告",content:"是否退出登录",success:function(e){e.confirm?o.loginOutCf():e.cancel&&console.log("用户点击取消")}})},modifyTruePass(){var o=this;o.passnew!=o.pascheck?e.index.showToast({title:"密码不正确",duration:2e3}):(e.index.showLoading({title:"修改中……"}),e.index.request({url:"/api/ika/v1/user/modifypass",method:"POST",timeout:3e3,header:{Authorization:o.userInfo.token},data:{name:o.userInfo.id,password:o.passnew},success:i=>{e.index.hideLoading(),1===i.data.status?(e.index.showToast({title:"修改密码成功",icon:"success",duration:2e3}),o.$refs.popup.close()):e.index.showToast({title:"修改用户密码："+i.data.message,icon:"error",duration:2e3})},fail:o=>{e.index.hideLoading(),e.index.showToast({title:"修改用户密码："+o.errMsg,icon:"fail",duration:2e3})}}))},loginOutCf(){e.index.showLoading({title:"退出退录中……"}),e.index.request({url:"/api/ika/v1/user/loginout",method:"GET",timeout:3e3,header:{Authorization:this.userInfo.token},success:o=>{e.index.hideLoading(),1===o.data.status?(e.index.clearStorage(),e.index.switchTab({url:"/pages/index/index"})):e.index.showToast({title:"退登失败："+o.data.message,icon:"error",duration:2e3})},fail:o=>{e.index.hideLoading(),e.index.showToast({title:"退登异常："+o.errMsg,icon:"fail",duration:2e3})}})},UserNamePassWrodFocusBorderStyle(){this.inputColorConfigToUserName.borderColor=this.colorFocusColor},PassWordFocusBorderStyle(){this.inputColorConfigToPassWord.borderColor=this.colorFocusColor},UserNamePassWrodBlurBorderStyle(){this.inputColorConfigToUserName.borderColor=this.colorDefault},PassWordBlurBorderStyle(){this.inputColorConfigToPassWord.borderColor=this.colorDefault},getUserInfo01(){var o=this,i=e.index.getStorageSync("user_info");e.index.showLoading({title:"获取中……"}),e.index.request({url:"/api/ika/v1/user/findbyid",method:"GET",timeout:3e3,header:{Authorization:i.token},success:i=>{e.index.hideLoading(),1===i.data.status?(o.nickName=i.data.data.uName,o.mobile=i.data.data.phone,o.email=i.data.data.email,o.date=i.data.data.birthday.substring(0,10),o.index=i.data.data.gender,o.description=i.data.data.introduction):e.index.showToast({title:"请求用户信息："+i.data.message,icon:"error",duration:2e3})},fail:o=>{e.index.hideLoading(),e.index.showToast({title:"请求用户信息："+o.errMsg,icon:"fail",duration:2e3})}})},bindPickerChange(e){this.index=e.detail.value},bindRegionChange(e){this.region=e.detail.value},bindDateChange(e){this.date=e.detail.value},bindnickName(e){this.nickName=e.detail.value},bindmobile(e){this.mobile=e.detail.value},binddescription(e){this.description=e.detail.value},bindEmail(e){this.email=e.detail.value},avatarChoose(){let o=this;e.index.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success(e){o.imgUpload(e.tempFilePaths),e.tempFilePaths}})},getUserInfo(){e.index.getUserProfile({desc:"用于完善会员资料",success:o=>{console.log(o),e.index.showToast({title:"已授权",icon:"none",duration:2e3})}})},getphonenumber(o){o.detail.iv&&(console.log(o.detail.iv),e.index.showToast({title:"已授权",icon:"none",duration:2e3}))},savaInfo(){const o=e.index.getStorageSync("user_info");let i=this,a=i.nickName,t=i.index,n=i.mobile,s=i.email,d=i.date,r=i.description,l={id:o.id,weixinId:o.weixinId};a?(l.uName=a,l.gender=t,l.email=s,i.isPoneAvailable(n)?(l.phone=n,"0000-00-00"!=d?(l.birthday=d,l.introduction=r,i.updata(l)):e.index.showToast({title:"请选择生日",icon:"none",duration:2e3})):e.index.showToast({title:"手机号码有误，请重填",icon:"none",duration:2e3})):e.index.showToast({title:"请填写昵称",icon:"none",duration:2e3})},isPoneAvailable:e=>!!/^[1][3,4,5,7,8][0-9]{9}$/.test(e),async updata(o){e.index.showLoading({title:"修改中……"}),e.index.request({url:"/api/ika/v1/user/modify",method:"POST",timeout:3e3,header:{Authorization:this.userInfo.token},data:o,success:o=>{e.index.hideLoading(),1===o.data.status?e.index.showToast({title:"修改成功",icon:"success",duration:2e3}):e.index.showToast({title:"修改用户信息："+o.data.message,icon:"error",duration:2e3})},fail:o=>{e.index.hideLoading(),e.index.showToast({title:"修改用户信息："+o.errMsg,icon:"fail",duration:2e3})}})},imgUpload(o){let i=this;e.index.uploadFile({header:{Authorization:e.index.getStorageSync("token")},url:"/api/upload/image",filePath:o[0],name:"file",formData:{type:"user_headimg"},success:function(e){var o=JSON.parse(e.data);o=o.data,i.avater=i.url+o.img,i.headimg=i.url+o.img},fail:function(e){console.log(e)}})}}};if(!Array){(e.resolveComponent("uni-fab")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni_modules/uni-fab/components/uni-fab/uni-fab.js")+(()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();var i=e._export_sfc(o,[["render",function(o,i,a,t,n,s){return{a:n.value,b:n.nickName,c:e.o(((...e)=>s.bindnickName&&s.bindnickName(...e))),d:n.value,e:n.mobile,f:e.o(((...e)=>s.bindmobile&&s.bindmobile(...e))),g:n.value,h:n.email,i:e.o(((...e)=>s.bindEmail&&s.bindEmail(...e))),j:e.t(n.sex[n.index].name),k:e.o(((...e)=>s.bindPickerChange&&s.bindPickerChange(...e))),l:n.index,m:n.sex,n:e.t(n.date),o:n.date,p:e.o(((...e)=>s.bindDateChange&&s.bindDateChange(...e))),q:n.value,r:n.description,s:e.o(((...e)=>s.binddescription&&s.binddescription(...e))),t:e.o(((...e)=>s.savaInfo&&s.savaInfo(...e))),v:e.o(s.fabtrigger),w:e.p({content:n.fabcontent,horizontal:"right",vertical:"bottom",pattern:n.fabPattern}),x:e.o(s.PassWordFocusBorderStyle),y:e.o(s.PassWordBlurBorderStyle),z:e.o((e=>n.passnew=e)),A:e.p({type:"password",styles:n.inputColorConfigToPassWord,placeholder:"请输入密码",modelValue:n.passnew}),B:e.o(s.PassWordFocusBorderStyle),C:e.o(s.PassWordBlurBorderStyle),D:e.o((e=>n.pascheck=e)),E:e.p({type:"password",styles:n.inputColorConfigToPassWord,placeholder:"请确认密码",modelValue:n.pascheck}),F:e.o(((...e)=>s.modifyTruePass&&s.modifyTruePass(...e))),G:e.sr("popup","662a57af-1"),H:e.p({type:"top","background-color":"#fff"})}}]]);wx.createPage(i);
