"use strict";var e=require("../../common/vendor.js"),t=require("../../common/js/mylogin.js"),o=require("../../common/js/tools.js"),a=require("../../common/js/request.js");const n={data:()=>({userInfo:e.index.getStorageSync("user_info"),indicatorDots:!0,autoplay:!0,interval:2e3,duration:500,noticetext:"欢迎来到亲密记",incomecount:0,paycount:0,accountFormData:{money:0,reType:1,keepTime:"",remark:"",planId:"",payType:"",purpose:""},reTypes:[{text:"收入",value:0},{text:"支出",value:1}],planIdRange:[],purposeRange:[],payTypeRange:[],rules:{keepTime:{rules:[{required:!0,errorMessage:"请选择日期"}]},purpose:{rules:[{required:!0,errorMessage:"请选择账单分类"}]},payType:{rules:[{required:!0,errorMessage:"请选择支付方式"}]},money:{rules:[{format:"number",errorMessage:"金额只能输入数字"}]},remark:{rules:[{required:!0,errorMessage:"备注不能为空"}]}}}),onLoad(){this.getNotice(),this.getBillCount(!1)},onReady(){this.getPurpose(),this.getPayType()},methods:{getNotice(){var t=e.index.getStorageSync("notice_index");t>=10?e.index.request({url:"/api/ika/v1/sysdic/getnotice",method:"GET",timeout:3e3,success:t=>{console.log(t.data),1===t.data.status?(e.index.setStorageSync("notice_index",1),e.index.setStorageSync("notice_msg",t.data.message),this.noticetext=t.data.message):e.index.showToast({title:"请求通知信息："+t.data.message,icon:"error",duration:2e3})},fail:t=>{e.index.showToast({title:"请求通知信息："+t.errMsg,icon:"fail",duration:2e3})}}):(e.index.setStorageSync("notice_index",t+1),this.noticetext=e.index.getStorageSync("notice_msg"))},selectCount(){e.index.navigateTo({url:"/pages/index/monthbill/monthbill"})},getPurpose(){const t=e.index.getStorageSync("purpose_data");null!==t&&""!==t||(a.request.getPurpose(),t=e.index.getStorageSync("purpose_data")),this.purposeRange=t},getPayType(){const t=e.index.getStorageSync("paytype_data");null!==t&&""!==t||(a.request.getPayType(),t=e.index.getStorageSync("paytype_data")),this.payTypeRange=t},addBill(){t.mylogin.checkLogin(!1)?this.$refs.popup.open():e.index.showToast({title:"请先登录",icon:"exception",duration:2e3})},submitAccount(t){var a=this;a.$refs[t].validate().then((t=>{e.index.request({url:"/api/ika/v1/accountrecord/add",method:"POST",timeout:3e3,header:{Authorization:a.userInfo.token},data:a.accountFormData,success:t=>{1===t.data.status?(e.index.showToast({title:t.data.message,icon:"success",duration:1e3}),a.$refs.popup.close(),a.accountFormData.keepTime.substring(0,7)===o.tools.formatMonth(new Date)&&a.getBillCount(!0)):e.index.showToast({title:t.data.message,icon:"error",duration:2e3})},fail:t=>{e.index.showToast({title:t.errMsg,icon:"fail",duration:2e3})}})})).catch((t=>{e.index.showToast({title:t[0].errorMessage,icon:"fail",duration:2e3})}))},changeDate(e){this.accountFormData.keepTime=e},getPlanData(){var t=this;let a=t.accountFormData.keepTime;""===a&&(a=o.tools.formatDate(new Date)),e.index.request({url:"/api/ika/v1/plan/getbydate?date="+a,method:"GET",timeout:3e3,header:{Authorization:t.userInfo.token},success:o=>{1===o.data.status?t.planIdRange=o.data.data:e.index.showToast({title:o.data.message,icon:"error",duration:2e3})},fail:t=>{e.index.showToast({title:t.errMsg,icon:"fail",duration:2e3})}})},changePlanId(e){this.accountFormData.planId=e},getBillCount(o){var n=this;if(!t.mylogin.checkLogin(!1))return;e.index.showLoading({title:"金额统计刷新中……"});let i=100;o&&(i=2e3),a.request.getMonthBillCount(o),setTimeout((()=>{const t=e.index.getStorageSync("month_income_cache"),o=e.index.getStorageSync("month_paymoney_cache");n.incomecount=t,n.paycount=o,e.index.hideLoading()}),i)}}};if(!Array){(e.resolveComponent("uni-notice-bar")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../uni_modules/uni-notice-bar/components/uni-notice-bar/uni-notice-bar.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();var i=e._export_sfc(n,[["render",function(t,o,a,n,i,r){return e.e({a:i.noticetext},i.noticetext?{b:e.p({scrollable:!0,single:!0,text:i.noticetext})}:{},{c:i.indicatorDots,d:i.autoplay,e:i.interval,f:i.duration,g:e.t(i.incomecount),h:e.t(i.paycount),i:e.o(((...e)=>r.selectCount&&r.selectCount(...e))),j:e.o(((...e)=>r.addBill&&r.addBill(...e))),k:e.o((e=>i.accountFormData.money=e)),l:e.p({placeholder:"请输入金额",modelValue:i.accountFormData.money}),m:e.p({label:"金额",required:!0,name:"money"}),n:e.o((e=>i.accountFormData.reType=e)),o:e.p({mode:"button",localdata:i.reTypes,modelValue:i.accountFormData.reType}),p:e.p({label:"收支",required:!0}),q:e.o(r.changeDate),r:e.o((e=>i.accountFormData.keepTime=e)),s:e.p({type:"date","clear-icon":!1,modelValue:i.accountFormData.keepTime}),t:e.p({label:"日期",required:!0,name:"keepTime"}),v:e.o((e=>i.accountFormData.purpose=e)),w:e.p({localdata:i.purposeRange,modelValue:i.accountFormData.purpose}),x:e.p({label:"账单分类",required:!0,name:"purpose"}),y:e.o((e=>i.accountFormData.payType=e)),z:e.p({localdata:i.payTypeRange,modelValue:i.accountFormData.payType}),A:e.p({label:"支付方式",required:!0,name:"payType"}),B:e.o(r.getPlanData),C:e.o(r.changePlanId),D:e.o((e=>i.accountFormData.planId=e)),E:e.p({localdata:i.planIdRange,modelValue:i.accountFormData.planId}),F:e.p({label:"计划",name:"planId"}),G:e.o((e=>i.accountFormData.remark=e)),H:e.p({type:"textarea",placeholder:"请输入备注",modelValue:i.accountFormData.remark}),I:e.p({label:"备注",required:!0,name:"remark"}),J:e.sr("valiForm","30ee232c-2,30ee232c-1"),K:e.p({rules:i.rules,modelValue:i.accountFormData}),L:e.o((e=>r.submitAccount("valiForm"))),M:e.sr("popup","30ee232c-1"),N:e.p({type:"left","background-color":"#fff"})})}]]);wx.createPage(i);
