import{h as e,C as a,k as o,m as t,j as i,p as l,aa as s,ab as n,G as r,K as d,o as u,q as c,d as p,w as f,f as m,t as h,F as g,i as b,I as v,g as C,a1 as y,B as _,y as P,r as k}from"./index.4e9e22c6.js";import{_ as I}from"./uni-fab.b05b1471.js";import{_ as x,r as T}from"./uni-app.es.4dca259d.js";import{_ as B}from"./uni-easyinput.ecec7ebb.js";import{_ as w}from"./uni-popup.e977e3bd.js";import"./uni-icons.f3e1d0b6.js";var N=x({data:()=>({value:"请填写",sex:[{id:0,name:"男"},{id:1,name:"女"},{id:2,name:"不明"}],index:0,date:"请填写",avater:"",description:"",url:"",nickName:"",mobile:"",headimg:"",email:"",fabcontent:[{iconPath:"/static/images/icon/modifypwd.png",selectedIconPath:"/static/images/icon/modifypwd.png",text:"改密",active:!1},{iconPath:"/static/images/icon/loginout.png",selectedIconPath:"/static/images/icon/loginout.png",text:"退登",active:!1}],fabPattern:{backgroundColor:"#fff",buttonColor:"#000000",iconColor:"#fff"},userInfo:e("user_info"),colorDefault:"#b4b4b4",colorFocusColor:"#66ffff",inputColorConfigToUserName:{color:"#000000",disableColor:"#eee",borderColor:"#b4b4b4"},inputColorConfigToPassWord:{color:"#000000",disableColor:"#eee",borderColor:"#b4b4b4"},passnew:"",pascheck:""}),onLoad(){this.getUserInfo01()},methods:{fabtrigger(e){"改密"===e.item.text?this.modifyPassword():"退登"===e.item.text&&this.loginOut()},modifyPassword(){this.$refs.popup.open()},loginOut(){var e=this;a({title:"敬告",content:"是否退出登录",success:function(a){a.confirm?e.loginOutCf():a.cancel&&console.log("用户点击取消")}})},modifyTruePass(){var e=this;e.passnew!=e.pascheck?o({title:"密码不正确",duration:2e3}):(t({title:"修改中……"}),i({url:"/api/ika/v1/user/modifypass",method:"POST",timeout:3e3,header:{Authorization:e.userInfo.token},data:{name:e.userInfo.id,password:e.passnew},success:a=>{l(),1===a.data.status?(o({title:"修改密码成功",icon:"success",duration:2e3}),e.$refs.popup.close()):o({title:"修改用户密码："+a.data.message,icon:"error",duration:2e3})},fail:e=>{l(),o({title:"修改用户密码："+e.errMsg,icon:"fail",duration:2e3})}}))},loginOutCf(){t({title:"退出退录中……"}),i({url:"/api/ika/v1/user/loginout",method:"GET",timeout:3e3,header:{Authorization:this.userInfo.token},success:e=>{l(),1===e.data.status?(s(),n({url:"/pages/index/index"})):o({title:"退登失败："+e.data.message,icon:"error",duration:2e3})},fail:e=>{l(),o({title:"退登异常："+e.errMsg,icon:"fail",duration:2e3})}})},UserNamePassWrodFocusBorderStyle(){this.inputColorConfigToUserName.borderColor=this.colorFocusColor},PassWordFocusBorderStyle(){this.inputColorConfigToPassWord.borderColor=this.colorFocusColor},UserNamePassWrodBlurBorderStyle(){this.inputColorConfigToUserName.borderColor=this.colorDefault},PassWordBlurBorderStyle(){this.inputColorConfigToPassWord.borderColor=this.colorDefault},getUserInfo01(){var a=this,s=e("user_info");t({title:"获取中……"}),i({url:"/api/ika/v1/user/findbyid",method:"GET",timeout:3e3,header:{Authorization:s.token},success:e=>{l(),1===e.data.status?(a.nickName=e.data.data.uName,a.mobile=e.data.data.phone,a.email=e.data.data.email,a.date=e.data.data.birthday.substring(0,10),a.index=e.data.data.gender,a.description=e.data.data.introduction):o({title:"请求用户信息："+e.data.message,icon:"error",duration:2e3})},fail:e=>{l(),o({title:"请求用户信息："+e.errMsg,icon:"fail",duration:2e3})}})},bindPickerChange(e){this.index=e.detail.value},bindRegionChange(e){this.region=e.detail.value},bindDateChange(e){this.date=e.detail.value},bindnickName(e){this.nickName=e.detail.value},bindmobile(e){this.mobile=e.detail.value},binddescription(e){this.description=e.detail.value},bindEmail(e){this.email=e.detail.value},avatarChoose(){let e=this;r({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success(a){e.imgUpload(a.tempFilePaths),a.tempFilePaths}})},getUserInfo(){uni.getUserProfile({desc:"用于完善会员资料",success:e=>{console.log(e),o({title:"已授权",icon:"none",duration:2e3})}})},getphonenumber(e){e.detail.iv&&(console.log(e.detail.iv),o({title:"已授权",icon:"none",duration:2e3}))},savaInfo(){const a=e("user_info");let t=this,i=t.nickName,l=t.index,s=t.mobile,n=t.email,r=t.date,d=t.description,u={id:a.id,weixinId:a.weixinId};i?(u.uName=i,u.gender=l,u.email=n,t.isPoneAvailable(s)?(u.phone=s,"0000-00-00"!=r?(u.birthday=r,u.introduction=d,t.updata(u)):o({title:"请选择生日",icon:"none",duration:2e3})):o({title:"手机号码有误，请重填",icon:"none",duration:2e3})):o({title:"请填写昵称",icon:"none",duration:2e3})},isPoneAvailable:e=>!!/^[1][3,4,5,7,8][0-9]{9}$/.test(e),async updata(e){t({title:"修改中……"}),i({url:"/api/ika/v1/user/modify",method:"POST",timeout:3e3,header:{Authorization:this.userInfo.token},data:e,success:e=>{l(),1===e.data.status?o({title:"修改成功",icon:"success",duration:2e3}):o({title:"修改用户信息："+e.data.message,icon:"error",duration:2e3})},fail:e=>{l(),o({title:"修改用户信息："+e.errMsg,icon:"fail",duration:2e3})}})},imgUpload(a){let o=this;d({header:{Authorization:e("token")},url:"/api/upload/image",filePath:a[0],name:"file",formData:{type:"user_headimg"},success:function(e){var a=JSON.parse(e.data);a=a.data,o.avater=o.url+a.img,o.headimg=o.url+a.img},fail:function(e){console.log(e)}})}}},[["render",function(e,a,o,t,i,l){const s=b,n=v,r=C,d=y,x=_,N=P,F=T(k("uni-fab"),I),U=T(k("uni-easyinput"),B),W=T(k("uni-popup"),w);return u(),c(g,null,[p(r,{class:"container"},{default:f((()=>[p(r,{class:"ui-all"},{default:f((()=>[p(r,{class:"ui-list"},{default:f((()=>[p(s,null,{default:f((()=>[m("用户名")])),_:1}),p(n,{type:"text",placeholder:i.value,value:i.nickName,onInput:l.bindnickName,"placeholder-class":"place"},null,8,["placeholder","value","onInput"])])),_:1}),p(r,{class:"ui-list"},{default:f((()=>[p(s,null,{default:f((()=>[m("手机号")])),_:1}),p(n,{type:"tel",disable:"true",placeholder:i.value,value:i.mobile,onInput:l.bindmobile,"placeholder-class":"place"},null,8,["placeholder","value","onInput"])])),_:1}),p(r,{class:"ui-list"},{default:f((()=>[p(s,null,{default:f((()=>[m("邮箱")])),_:1}),p(n,{type:"text",placeholder:i.value,value:i.email,onInput:l.bindEmail,"placeholder-class":"place"},null,8,["placeholder","value","onInput"])])),_:1}),p(r,{class:"ui-list right"},{default:f((()=>[p(s,null,{default:f((()=>[m("性别")])),_:1}),p(d,{onChange:l.bindPickerChange,mode:"selector","range-key":"name",value:i.index,range:i.sex},{default:f((()=>[p(r,{class:"picker"},{default:f((()=>[m(h(i.sex[i.index].name),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),p(r,{class:"ui-list right"},{default:f((()=>[p(s,null,{default:f((()=>[m("生日")])),_:1}),p(d,{mode:"date",value:i.date,onChange:l.bindDateChange},{default:f((()=>[p(r,{class:"picker"},{default:f((()=>[m(h(i.date),1)])),_:1})])),_:1},8,["value","onChange"])])),_:1}),p(r,{class:"ui-list"},{default:f((()=>[p(s,null,{default:f((()=>[m("个人介绍")])),_:1}),p(x,{placeholder:i.value,"placeholder-class":"place",value:i.description,onInput:l.binddescription},null,8,["placeholder","value","onInput"])])),_:1}),p(N,{class:"save",onClick:l.savaInfo},{default:f((()=>[m("保 存 修 改")])),_:1},8,["onClick"])])),_:1})])),_:1}),p(r,null,{default:f((()=>[p(F,{content:i.fabcontent,horizontal:"right",vertical:"bottom",onTrigger:l.fabtrigger,pattern:i.fabPattern},null,8,["content","onTrigger","pattern"])])),_:1}),p(r,null,{default:f((()=>[p(W,{ref:"popup",type:"top","background-color":"#fff"},{default:f((()=>[p(r,{class:"modify_view"},{default:f((()=>[p(U,{class:"hj-input",modelValue:i.passnew,"onUpdate:modelValue":a[0]||(a[0]=e=>i.passnew=e),type:"password",onFocus:l.PassWordFocusBorderStyle,onBlur:l.PassWordBlurBorderStyle,styles:i.inputColorConfigToPassWord,placeholder:"请输入密码"},null,8,["modelValue","onFocus","onBlur","styles"]),p(U,{class:"hj-input",modelValue:i.pascheck,"onUpdate:modelValue":a[1]||(a[1]=e=>i.pascheck=e),type:"password",onFocus:l.PassWordFocusBorderStyle,onBlur:l.PassWordBlurBorderStyle,styles:i.inputColorConfigToPassWord,placeholder:"请确认密码"},null,8,["modelValue","onFocus","onBlur","styles"]),p(N,{class:"form-btn",type:"primary",onClick:l.modifyTruePass},{default:f((()=>[m("确 认")])),_:1},8,["onClick"])])),_:1})])),_:1},512)])),_:1})],64)}],["__scopeId","data-v-57489bdc"]]);export{N as default};
