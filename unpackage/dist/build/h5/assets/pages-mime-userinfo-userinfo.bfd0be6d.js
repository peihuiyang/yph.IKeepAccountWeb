import{h as e,C as a,k as o,m as t,p as i,N as s,ac as l,G as n,L as r,o as d,q as u,d as c,w as p,f,t as m,F as h,i as g,I as b,g as v,a2 as C,B as y,y as _,r as P}from"./index.cf581458.js";import{_ as k}from"./uni-fab.56c04aab.js";import{_ as I,r as x}from"./uni-app.es.afd85a62.js";import{_ as T}from"./uni-easyinput.27dc1e22.js";import{_ as B}from"./uni-popup.6b936009.js";import"./uni-icons.bf1f9060.js";var w=I({data:()=>({value:"请填写",sex:[{id:0,name:"男"},{id:1,name:"女"},{id:2,name:"不明"}],index:0,date:"请填写",avater:"",description:"",url:"",nickName:"",mobile:"",headimg:"",email:"",fabcontent:[{iconPath:"/static/images/icon/modifypwd.png",selectedIconPath:"/static/images/icon/modifypwd.png",text:"改密",active:!1},{iconPath:"/static/images/icon/loginout.png",selectedIconPath:"/static/images/icon/loginout.png",text:"退登",active:!1}],fabPattern:{backgroundColor:"#fff",buttonColor:"#000000",iconColor:"#fff"},userInfo:e("user_info"),colorDefault:"#b4b4b4",colorFocusColor:"#66ffff",inputColorConfigToUserName:{color:"#000000",disableColor:"#eee",borderColor:"#b4b4b4"},inputColorConfigToPassWord:{color:"#000000",disableColor:"#eee",borderColor:"#b4b4b4"},passnew:"",pascheck:""}),onLoad(){this.getUserInfo01()},methods:{fabtrigger(e){"改密"===e.item.text?this.modifyPassword():"退登"===e.item.text&&this.loginOut()},modifyPassword(){this.$refs.popup.open()},loginOut(){var e=this;a({title:"敬告",content:"是否退出登录",success:function(a){a.confirm?e.loginOutCf():a.cancel&&console.log("用户点击取消")}})},modifyTruePass(){var e=this;e.passnew!=e.pascheck?o({title:"密码不正确",duration:2e3}):(t({title:"修改中……"}),e.$myapi.baseRequest("/api/ika/v1/user/modifypass","POST",e.userInfo.token,{name:e.userInfo.id,password:e.passnew}).then((a=>{i(),1===a.data.status?(o({title:"修改密码成功",icon:"success",duration:2e3}),e.$refs.popup.close()):o({title:"修改用户密码："+a.data.message,icon:"error",duration:2e3})})).catch((e=>{i(),o({title:"修改用户密码："+res.errMsg,icon:"fail",duration:2e3})})))},loginOutCf(){t({title:"退出退录中……"}),this.$myapi.baseRequest("/api/ika/v1/user/loginout","GET",this.userInfo.token,{}).then((e=>{i(),1===e.data.status?(s(),l({url:"/pages/index/index"})):o({title:"退登失败："+e.data.message,icon:"error",duration:2e3})})).catch((e=>{i(),o({title:"退登异常："+res.errMsg,icon:"fail",duration:2e3})}))},UserNamePassWrodFocusBorderStyle(){this.inputColorConfigToUserName.borderColor=this.colorFocusColor},PassWordFocusBorderStyle(){this.inputColorConfigToPassWord.borderColor=this.colorFocusColor},UserNamePassWrodBlurBorderStyle(){this.inputColorConfigToUserName.borderColor=this.colorDefault},PassWordBlurBorderStyle(){this.inputColorConfigToPassWord.borderColor=this.colorDefault},getUserInfo01(){var a=this;e("user_info"),t({title:"获取中……"}),a.$myapi.baseRequest("/api/ika/v1/user/findbyid","GET",a.userInfo.token,{}).then((e=>{i(),1===e.data.status?(a.nickName=e.data.data.uName,a.mobile=e.data.data.phone,a.email=e.data.data.email,a.date=e.data.data.birthday.substring(0,10),a.index=e.data.data.gender,a.description=e.data.data.introduction):o({title:"请求用户信息："+e.data.message,icon:"error",duration:2e3})})).catch((e=>{i(),o({title:"请求用户信息："+res.errMsg,icon:"fail",duration:2e3})}))},bindPickerChange(e){this.index=e.detail.value},bindRegionChange(e){this.region=e.detail.value},bindDateChange(e){this.date=e.detail.value},bindnickName(e){this.nickName=e.detail.value},bindmobile(e){this.mobile=e.detail.value},binddescription(e){this.description=e.detail.value},bindEmail(e){this.email=e.detail.value},avatarChoose(){let e=this;n({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success(a){e.imgUpload(a.tempFilePaths),a.tempFilePaths}})},getUserInfo(){uni.getUserProfile({desc:"用于完善会员资料",success:e=>{console.log(e),o({title:"已授权",icon:"none",duration:2e3})}})},getphonenumber(e){e.detail.iv&&(console.log(e.detail.iv),o({title:"已授权",icon:"none",duration:2e3}))},savaInfo(){const a=e("user_info");let t=this,i=t.nickName,s=t.index,l=t.mobile,n=t.email,r=t.date,d=t.description,u={id:a.id,weixinId:a.weixinId};i?(u.uName=i,u.gender=s,u.email=n,t.isPoneAvailable(l)?(u.phone=l,"0000-00-00"!=r?(u.birthday=r,u.introduction=d,t.updata(u)):o({title:"请选择生日",icon:"none",duration:2e3})):o({title:"手机号码有误，请重填",icon:"none",duration:2e3})):o({title:"请填写昵称",icon:"none",duration:2e3})},isPoneAvailable:e=>!!/^[1][3,4,5,7,8][0-9]{9}$/.test(e),async updata(e){t({title:"修改中……"}),this.$myapi.baseRequest("/api/ika/v1/user/modify","POST",this.userInfo.token,e).then((e=>{i(),1===e.data.status?o({title:"修改成功",icon:"success",duration:2e3}):o({title:"修改用户信息："+e.data.message,icon:"error",duration:2e3})})).catch((e=>{i(),o({title:"修改用户信息："+res.errMsg,icon:"fail",duration:2e3})}))},imgUpload(a){let o=this;r({header:{Authorization:e("token")},url:"/api/upload/image",filePath:a[0],name:"file",formData:{type:"user_headimg"},success:function(e){var a=JSON.parse(e.data);a=a.data,o.avater=o.url+a.img,o.headimg=o.url+a.img},fail:function(e){console.log(e)}})}}},[["render",function(e,a,o,t,i,s){const l=g,n=b,r=v,I=C,w=y,N=_,F=x(P("uni-fab"),k),U=x(P("uni-easyinput"),T),W=x(P("uni-popup"),B);return d(),u(h,null,[c(r,{class:"container"},{default:p((()=>[c(r,{class:"ui-all"},{default:p((()=>[c(r,{class:"ui-list"},{default:p((()=>[c(l,null,{default:p((()=>[f("用户名")])),_:1}),c(n,{type:"text",placeholder:i.value,value:i.nickName,onInput:s.bindnickName,"placeholder-class":"place"},null,8,["placeholder","value","onInput"])])),_:1}),c(r,{class:"ui-list"},{default:p((()=>[c(l,null,{default:p((()=>[f("手机号")])),_:1}),c(n,{type:"tel",disable:"true",placeholder:i.value,value:i.mobile,onInput:s.bindmobile,"placeholder-class":"place"},null,8,["placeholder","value","onInput"])])),_:1}),c(r,{class:"ui-list"},{default:p((()=>[c(l,null,{default:p((()=>[f("邮箱")])),_:1}),c(n,{type:"text",placeholder:i.value,value:i.email,onInput:s.bindEmail,"placeholder-class":"place"},null,8,["placeholder","value","onInput"])])),_:1}),c(r,{class:"ui-list right"},{default:p((()=>[c(l,null,{default:p((()=>[f("性别")])),_:1}),c(I,{onChange:s.bindPickerChange,mode:"selector","range-key":"name",value:i.index,range:i.sex},{default:p((()=>[c(r,{class:"picker"},{default:p((()=>[f(m(i.sex[i.index].name),1)])),_:1})])),_:1},8,["onChange","value","range"])])),_:1}),c(r,{class:"ui-list right"},{default:p((()=>[c(l,null,{default:p((()=>[f("生日")])),_:1}),c(I,{mode:"date",value:i.date,onChange:s.bindDateChange},{default:p((()=>[c(r,{class:"picker"},{default:p((()=>[f(m(i.date),1)])),_:1})])),_:1},8,["value","onChange"])])),_:1}),c(r,{class:"ui-list"},{default:p((()=>[c(l,null,{default:p((()=>[f("个人介绍")])),_:1}),c(w,{placeholder:i.value,"placeholder-class":"place",value:i.description,onInput:s.binddescription},null,8,["placeholder","value","onInput"])])),_:1}),c(N,{class:"save",onClick:s.savaInfo},{default:p((()=>[f("保 存 修 改")])),_:1},8,["onClick"])])),_:1})])),_:1}),c(r,null,{default:p((()=>[c(F,{content:i.fabcontent,horizontal:"right",vertical:"bottom",onTrigger:s.fabtrigger,pattern:i.fabPattern},null,8,["content","onTrigger","pattern"])])),_:1}),c(r,null,{default:p((()=>[c(W,{ref:"popup",type:"top","background-color":"#fff"},{default:p((()=>[c(r,{class:"modify_view"},{default:p((()=>[c(U,{class:"hj-input",modelValue:i.passnew,"onUpdate:modelValue":a[0]||(a[0]=e=>i.passnew=e),type:"password",onFocus:s.PassWordFocusBorderStyle,onBlur:s.PassWordBlurBorderStyle,styles:i.inputColorConfigToPassWord,placeholder:"请输入密码"},null,8,["modelValue","onFocus","onBlur","styles"]),c(U,{class:"hj-input",modelValue:i.pascheck,"onUpdate:modelValue":a[1]||(a[1]=e=>i.pascheck=e),type:"password",onFocus:s.PassWordFocusBorderStyle,onBlur:s.PassWordBlurBorderStyle,styles:i.inputColorConfigToPassWord,placeholder:"请确认密码"},null,8,["modelValue","onFocus","onBlur","styles"]),c(N,{class:"form-btn",type:"primary",onClick:s.modifyTruePass},{default:p((()=>[f("确 认")])),_:1},8,["onClick"])])),_:1})])),_:1},512)])),_:1})],64)}],["__scopeId","data-v-a9304bb8"]]);export{w as default};
