import{Q as e,o as a,a as t,w as l,A as o,e as n,g as r,a0 as i,r as s,d as u,b as d,n as c,f as p,t as m,i as h,h as f,s as g,aa as y,k as b,m as k,p as _,q as D,F as T,U as C,I as v,a5 as B,y as x}from"./index.cf581458.js";import{_ as w}from"./uni-icons.bf1f9060.js";import{_ as F,r as I}from"./uni-app.es.afd85a62.js";import{_ as V,a as q}from"./uni-swipe-action.b6b442a4.js";import{e as S,a as R,_ as M,b as P,d as $,c as L}from"./uni-forms.678c2c7d.js";import{_ as U}from"./uni-popup.6b936009.js";import{_ as j}from"./uni-easyinput.27dc1e22.js";import{_ as E}from"./uni-fab.56c04aab.js";import{f as W}from"./fui-empty.6eaeca7d.js";import{t as z}from"./tools.7dae34ab.js";import{r as H}from"./request.7e9a6223.js";const N=e=>"number"==typeof e?e+"px":e;var Y=F({name:"UniNavBar",components:{statusBar:F({name:"UniStatusBar",data:()=>({statusBarHeight:20}),mounted(){this.statusBarHeight=e().statusBarHeight+"px"}},[["render",function(e,i,s,u,d,c){const p=r;return a(),t(p,{style:n({height:d.statusBarHeight}),class:"uni-status-bar"},{default:l((()=>[o(e.$slots,"default",{},void 0,!0)])),_:3},8,["style"])}],["__scopeId","data-v-4fab0372"]])},emits:["clickLeft","clickRight","clickTitle"],props:{dark:{type:Boolean,default:!1},title:{type:String,default:""},leftText:{type:String,default:""},rightText:{type:String,default:""},leftIcon:{type:String,default:""},rightIcon:{type:String,default:""},fixed:{type:[Boolean,String],default:!1},color:{type:String,default:""},backgroundColor:{type:String,default:""},statusBar:{type:[Boolean,String],default:!1},shadow:{type:[Boolean,String],default:!1},border:{type:[Boolean,String],default:!0},height:{type:[Number,String],default:44},leftWidth:{type:[Number,String],default:60},rightWidth:{type:[Number,String],default:60},stat:{type:[Boolean,String],default:""}},computed:{themeBgColor(){return this.dark?this.backgroundColor?this.backgroundColor:this.dark?"#333":"#FFF":this.backgroundColor||"#FFF"},themeColor(){return this.dark?this.color?this.color:this.dark?"#fff":"#333":this.color||"#333"},navbarHeight(){return N(this.height)},leftIconWidth(){return N(this.leftWidth)},rightIconWidth(){return N(this.rightWidth)}},mounted(){uni.report&&this.stat&&""!==this.title&&uni.report("title",this.title)},methods:{onClickLeft(){this.$emit("clickLeft")},onClickRight(){this.$emit("clickRight")},onClickTitle(){this.$emit("clickTitle")}}},[["render",function(e,f,g,y,b,k){const _=i("status-bar"),D=I(s("uni-icons"),w),T=r,C=h;return a(),t(T,{class:c(["uni-navbar",{"uni-dark":g.dark,"uni-nvue-fixed":g.fixed}])},{default:l((()=>[u(T,{class:c(["uni-navbar__content",{"uni-navbar--fixed":g.fixed,"uni-navbar--shadow":g.shadow,"uni-navbar--border":g.border}]),style:n({"background-color":k.themeBgColor})},{default:l((()=>[g.statusBar?(a(),t(_,{key:0})):d("",!0),u(T,{style:n({color:k.themeColor,backgroundColor:k.themeBgColor,height:k.navbarHeight}),class:"uni-navbar__header"},{default:l((()=>[u(T,{onClick:k.onClickLeft,class:"uni-navbar__header-btns uni-navbar__header-btns-left",style:n({width:k.leftIconWidth})},{default:l((()=>[o(e.$slots,"left",{},(()=>[g.leftIcon.length>0?(a(),t(T,{key:0,class:"uni-navbar__content_view"},{default:l((()=>[u(D,{color:k.themeColor,type:g.leftIcon,size:"20"},null,8,["color","type"])])),_:1})):d("",!0),g.leftText.length?(a(),t(T,{key:1,class:c([{"uni-navbar-btn-icon-left":!g.leftIcon.length>0},"uni-navbar-btn-text"])},{default:l((()=>[u(C,{style:n({color:k.themeColor,fontSize:"12px"})},{default:l((()=>[p(m(g.leftText),1)])),_:1},8,["style"])])),_:1},8,["class"])):d("",!0)]),!0)])),_:3},8,["onClick","style"]),u(T,{class:"uni-navbar__header-container",onClick:k.onClickTitle},{default:l((()=>[o(e.$slots,"default",{},(()=>[g.title.length>0?(a(),t(T,{key:0,class:"uni-navbar__header-container-inner"},{default:l((()=>[u(C,{class:"uni-nav-bar-text uni-ellipsis-1",style:n({color:k.themeColor})},{default:l((()=>[p(m(g.title),1)])),_:1},8,["style"])])),_:1})):d("",!0)]),!0)])),_:3},8,["onClick"]),u(T,{onClick:k.onClickRight,class:"uni-navbar__header-btns uni-navbar__header-btns-right",style:n({width:k.rightIconWidth})},{default:l((()=>[o(e.$slots,"right",{},(()=>[g.rightIcon.length?(a(),t(T,{key:0},{default:l((()=>[u(D,{color:k.themeColor,type:g.rightIcon,size:"22"},null,8,["color","type"])])),_:1})):d("",!0),g.rightText.length&&!g.rightIcon.length?(a(),t(T,{key:1,class:"uni-navbar-btn-text"},{default:l((()=>[u(C,{class:"uni-nav-bar-right-text",style:n({color:k.themeColor})},{default:l((()=>[p(m(g.rightText),1)])),_:1},8,["style"])])),_:1})):d("",!0)]),!0)])),_:3},8,["onClick","style"])])),_:3},8,["style"])])),_:3},8,["class","style"]),g.fixed?(a(),t(T,{key:0,class:"uni-navbar__placeholder"},{default:l((()=>[g.statusBar?(a(),t(_,{key:0})):d("",!0),u(T,{class:"uni-navbar__placeholder-view",style:n({height:k.navbarHeight})},null,8,["style"])])),_:1})):d("",!0)])),_:3},8,["class"])}],["__scopeId","data-v-43ff2e90"]]);var A=F({components:{fuiEmpty:W},data:()=>({userInfo:f("user_info"),isDataEmpty:!0,swiperightoptions:[{text:"修改",style:{backgroundColor:"#007aff"}},{text:"删除",style:{backgroundColor:"#dd524d"}}],plandaterange:[Date.now()-5e8,Date.now()],queryBill:{pageIndex:1,pageSize:10,year:(new Date).getFullYear(),month:(new Date).getMonth()+1,reType:2,startTime:z.formatDate01((new Date).getFullYear(),(new Date).getMonth()+1,1),endTime:z.formatDate(new Date),remark:""},reTypes:[{text:"全部",value:2},{text:"收入",value:0},{text:"支出",value:1}],billDatas:[],loadStatus:"more",moreContentText:{contentdown:"加载更多",contentrefresh:"加载中",contentnomore:"我是有底线的"},accountFormData:{id:"",money:0,reType:1,keepTime:"",remark:"",planId:"",payType:"",purpose:""},billReTypes:[{text:"收入",value:0},{text:"支出",value:1}],planIdRange:[],purposeRange:[],payTypeRange:[],rules:{keepTime:{rules:[{required:!0,errorMessage:"请选择日期"}]},purpose:{rules:[{required:!0,errorMessage:"请选择账单分类"}]},payType:{rules:[{required:!0,errorMessage:"请选择支付方式"}]},money:{rules:[{format:"number",errorMessage:"金额只能输入数字"}]},remark:{rules:[{required:!0,errorMessage:"备注不能为空"}]}},content:[{iconPath:"/static/images/icon/backtop.png",selectedIconPath:"/static/images/icon/backtop.png",text:"置顶",active:!1}],showFabBtn:!1}),onLoad(){this.showData()},onPageScroll(e){e.scrollTop>=880?this.showFabBtn=!0:this.showFabBtn=!1},onPullDownRefresh(){this.showData(),setTimeout((function(){g()}),1e3)},methods:{swipeBindClick(e,a){"修改"===e.content.text?this.modifyBill(a):"删除"===e.content.text&&this.deleteBill(a)},fabtrigger(e){"置顶"===e.item.text&&this.backTop()},backTop(){y({scrollTop:0,duration:100})},clickLoadMore(e){var a=this;"more"===e.detail.status&&(a.loadStatus="loading",a.queryBill.pageIndex=a.queryBill.pageIndex+1,a.searchBill(a.queryBill.pageIndex))},modifyBill(e){var a=this;a.accountFormData={id:e.id,money:e.money,reType:e.reType,keepTime:e.keepTime.substring(0,10),remark:e.remark,planId:e.planId,payType:e.payType,purpose:e.purpose},a.getPurpose(),a.getPayType(),a.getPlanData(),a.$refs.billpopup.open()},deleteBill(e){var a=this;a.$myapi.baseRequest("/api/ika/v1/accountrecord/delete?id="+e.id,"DELETE",a.userInfo.token,{}).then((t=>{if(1===t.data.status){b({title:t.data.message,icon:"success",duration:2e3});let l=a.billDatas.findIndex((a=>a==e));console.log("索引："+l),l>=0&&a.billDatas.splice(l,1),a.billDatas.length>0&&(a.isDataEmpty=!1),e.year===(new Date).getFullYear()&&e.month===(new Date).getMonth()+1&&H.getMonthBillCount(!0)}else b({title:t.data.message,icon:"error",duration:2e3})})).catch((e=>{b({title:res.errMsg,icon:"fail",duration:2e3})}))},showData(){this.barRightClick(),this.billDatas.length>0&&(this.isDataEmpty=!1)},barLeftClick(){this.$refs.popup.open()},changeDate(e){this.queryBill.startTime=e[0],this.queryBill.endTime=e[1],this.queryBill.year=new Date(e[0]).getFullYear(),this.queryBill.month=new Date(e[0]).getMonth()+1},barRightClick(){this.searchBill(1)},searchBill(e){var a=this;a.queryBill.pageIndex=e,a.$myapi.baseRequest("/api/ika/v1/accountrecord/findbypage","POST",a.userInfo.token,a.queryBill).then((t=>{1===t.data.status?(1===e?(a.billDatas=[],a.billDatas=t.data.data.accounts):t.data.data.accounts.forEach(((e,t)=>{a.billDatas.push(e)})),t.data.data.totalNum>0&&(a.isDataEmpty=!1),t.data.data.pageSize*t.data.data.pageIndex>=t.data.data.totalNum?a.loadStatus="no-more":a.loadStatus="more",a.$refs.popup.close()):(b({title:t.data.message,icon:"error",duration:2e3}),a.loadStatus="no-more")})).catch((e=>{b({title:res.errMsg,icon:"fail",duration:2e3}),a.loadStatus="more"}))},getPurpose(){const e=f("purpose_data");null!==e&&""!==e||(H.getPurpose(),e=f("purpose_data")),this.purposeRange=e},getPayType(){const e=f("paytype_data");null!==e&&""!==e||(H.getPayType(),e=f("paytype_data")),this.payTypeRange=e},submitAccount(e){var a=this;a.$refs[e].validate().then((e=>{k({title:"数据上传中……"}),a.$myapi.baseRequest("/api/ika/v1/accountrecord/modify","POST",a.userInfo.token,a.accountFormData).then((e=>{_(),1===e.data.status?(b({title:e.data.message,icon:"success",duration:1e3}),a.$refs.billpopup.close(),a.showData(),a.accountFormData.year===(new Date).getFullYear()&&a.accountFormData.month===(new Date).getMonth()+1&&H.getMonthBillCount(!0)):b({title:e.data.message,icon:"error",duration:2e3})})).catch((a=>{_(),b({title:e.errMsg,icon:"fail",duration:2e3})}))})).catch((e=>{b({title:e[0].errorMessage,icon:"fail",duration:2e3})}))},changeBillDate(e){this.accountFormData.keepTime=e},getPlanData(){var e=this;let a=e.accountFormData.keepTime;""===a&&(a=z.formatDate(new Date)),e.$myapi.baseRequest("/api/ika/v1/plan/getbydate?date="+a,"GET",e.userInfo.token,{}).then((a=>{1===a.data.status?e.planIdRange=a.data.data:b({title:a.data.message,icon:"error",duration:2e3})})).catch((e=>{b({title:res.errMsg,icon:"fail",duration:2e3})}))},changePlanId(e){this.accountFormData.planId=e}}},[["render",function(e,o,n,f,g,y){const b=I(s("uni-icons"),w),k=v,_=r,F=I(s("uni-nav-bar"),Y),W=i("fui-empty"),z=h,H=I(s("uni-swipe-action-item"),V),N=I(s("uni-swipe-action"),q),A=I(s("uni-load-more"),S),O=B,G=I(s("uni-data-checkbox"),R),Q=I(s("uni-forms-item"),M),J=I(s("uni-datetime-picker"),P),K=I(s("uni-forms"),$),X=x,Z=I(s("uni-popup"),U),ee=I(s("uni-easyinput"),j),ae=I(s("uni-data-select"),L),te=I(s("uni-fab"),E);return a(),D(T,null,[u(_,{class:"box-bg"},{default:l((()=>[u(F,{class:"nav_bar",leftText:"按条件",leftIcon:"arrowdown",rightText:"搜索",rightIcon:"search",onClickLeft:y.barLeftClick,onClickRight:y.barRightClick},{default:l((()=>[u(_,{class:"input-view"},{default:l((()=>[u(b,{class:"input-uni-icon",type:"search",size:"18",color:"#999"}),u(k,{"confirm-type":"search",class:"nav-bar-input",type:"text",placeholder:"输入备注搜索",modelValue:g.queryBill.remark,"onUpdate:modelValue":o[0]||(o[0]=e=>g.queryBill.remark=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["onClickLeft","onClickRight"])])),_:1}),u(O,{"show-scrollbar":"false"},{default:l((()=>[g.isDataEmpty?(a(),t(_,{key:0,class:"data_empty"},{default:l((()=>[u(W,{class:"fui_empty",src:"../../static/images/image/img_data_3x.png",title:"暂无数据",descr:"请在首页先添加账单！"})])),_:1})):(a(),t(_,{key:1},{default:l((()=>[(a(!0),D(T,null,C(g.billDatas,(e=>(a(),t(_,null,{default:l((()=>[u(N,null,{default:l((()=>[(a(),t(H,{"right-options":g.swiperightoptions,show:"none","auto-close":!0,key:e.id,onClick:a=>y.swipeBindClick(a,e)},{default:l((()=>[u(_,{class:"billcard"},{default:l((()=>[u(_,{class:"billneirong"},{default:l((()=>[u(_,{class:"billtitle"},{default:l((()=>[u(z,null,{default:l((()=>[p(m(e.remark),1)])),_:2},1024)])),_:2},1024),u(_,{class:"billtypename"},{default:l((()=>[u(z,null,{default:l((()=>[p(m(e.purpose_Desc),1)])),_:2},1024)])),_:2},1024),u(_,{class:"billtime"},{default:l((()=>[u(z,null,{default:l((()=>[p(m(e.keepTime.substring(0,10)),1)])),_:2},1024)])),_:2},1024),u(_,{class:c(0===e.reType?"billprice":"billprice1")},{default:l((()=>[u(z,null,{default:l((()=>[p(m(1===e.reType?"-":"")+m(e.money),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["right-options","onClick"]))])),_:2},1024)])),_:2},1024)))),256)),u(A,{color:"#007AFF",status:g.loadStatus,iconType:"auto","content-text":g.moreContentText,onClickLoadMore:y.clickLoadMore},null,8,["status","content-text","onClickLoadMore"])])),_:1}))])),_:1}),u(_,null,{default:l((()=>[u(Z,{ref:"popup",type:"center","background-color":"#fff"},{default:l((()=>[u(_,{class:"add-account-form"},{default:l((()=>[u(K,{modelValue:g.queryBill,name:"queryBill"},{default:l((()=>[u(Q,{label:"收支"},{default:l((()=>[u(G,{mode:"button",modelValue:g.queryBill.reType,"onUpdate:modelValue":o[1]||(o[1]=e=>g.queryBill.reType=e),localdata:g.reTypes},null,8,["modelValue","localdata"])])),_:1}),u(Q,{label:"日期",name:"dateform"},{default:l((()=>[u(J,{modelValue:g.plandaterange,"onUpdate:modelValue":o[2]||(o[2]=e=>g.plandaterange=e),type:"daterange",onChange:y.changeDate},null,8,["modelValue","onChange"])])),_:1})])),_:1},8,["modelValue"]),u(X,{class:"form-btn",type:"primary",onClick:y.barRightClick},{default:l((()=>[p("搜索")])),_:1},8,["onClick"])])),_:1})])),_:1},512)])),_:1}),u(_,null,{default:l((()=>[u(Z,{ref:"billpopup",type:"right","background-color":"#fff"},{default:l((()=>[u(_,{class:"add-account-form"},{default:l((()=>[u(K,{ref:"valiForm",rules:g.rules,modelValue:g.accountFormData},{default:l((()=>[u(Q,{label:"金额",required:"",name:"money"},{default:l((()=>[u(ee,{modelValue:g.accountFormData.money,"onUpdate:modelValue":o[3]||(o[3]=e=>g.accountFormData.money=e),placeholder:"请输入金额"},null,8,["modelValue"])])),_:1}),u(Q,{label:"收支",required:""},{default:l((()=>[u(G,{mode:"button",modelValue:g.accountFormData.reType,"onUpdate:modelValue":o[4]||(o[4]=e=>g.accountFormData.reType=e),localdata:g.billReTypes},null,8,["modelValue","localdata"])])),_:1}),u(Q,{label:"日期",required:"",name:"keepTime"},{default:l((()=>[u(J,{type:"date","clear-icon":!1,modelValue:g.accountFormData.keepTime,"onUpdate:modelValue":o[5]||(o[5]=e=>g.accountFormData.keepTime=e),onChange:y.changeBillDate},null,8,["modelValue","onChange"])])),_:1}),u(Q,{label:"账单分类",required:"",name:"purpose"},{default:l((()=>[u(ae,{localdata:g.purposeRange,modelValue:g.accountFormData.purpose,"onUpdate:modelValue":o[6]||(o[6]=e=>g.accountFormData.purpose=e)},null,8,["localdata","modelValue"])])),_:1}),u(Q,{label:"支付方式",required:"",name:"payType"},{default:l((()=>[u(ae,{localdata:g.payTypeRange,modelValue:g.accountFormData.payType,"onUpdate:modelValue":o[7]||(o[7]=e=>g.accountFormData.payType=e)},null,8,["localdata","modelValue"])])),_:1}),u(Q,{label:"计划",name:"planId"},{default:l((()=>[u(ae,{modelValue:g.accountFormData.planId,"onUpdate:modelValue":o[8]||(o[8]=e=>g.accountFormData.planId=e),localdata:g.planIdRange,onChange:y.changePlanId},null,8,["modelValue","localdata","onChange"])])),_:1}),u(Q,{label:"备注",required:"",name:"remark"},{default:l((()=>[u(ee,{type:"textarea",modelValue:g.accountFormData.remark,"onUpdate:modelValue":o[9]||(o[9]=e=>g.accountFormData.remark=e),placeholder:"请输入备注"},null,8,["modelValue"])])),_:1})])),_:1},8,["rules","modelValue"]),u(X,{class:"form-btn",type:"primary",onClick:o[10]||(o[10]=e=>y.submitAccount("valiForm"))},{default:l((()=>[p("提交")])),_:1})])),_:1})])),_:1},512)])),_:1}),u(_,null,{default:l((()=>[g.showFabBtn?(a(),t(te,{key:0,content:g.content,horizontal:"right",vertical:"bottom",onTrigger:y.fabtrigger},null,8,["content","onTrigger"])):d("",!0)])),_:1})],64)}],["__scopeId","data-v-41c362a2"]]);export{A as default};
