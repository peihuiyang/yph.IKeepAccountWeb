"use strict";var t=require("./calendar.js");exports.Calendar=class{constructor({date:t,selected:e,startDate:a,endDate:s,range:l}={}){this.date=this.getDate(new Date),this.selected=e||[],this.startDate=a,this.endDate=s,this.range=l,this.cleanMultipleStatus(),this.weeks={}}setDate(t){this.selectDate=this.getDate(t),this._getWeek(this.selectDate.fullDate)}cleanMultipleStatus(){this.multipleStatus={before:"",after:"",data:[]}}resetSatrtDate(t){this.startDate=t}resetEndDate(t){this.endDate=t}getDate(t,e=0,a="day"){t||(t=new Date),"object"!=typeof t&&(t=t.replace(/-/g,"/"));const s=new Date(t);switch(a){case"day":s.setDate(s.getDate()+e);break;case"month":31===s.getDate()?s.setDate(s.getDate()+e):s.setMonth(s.getMonth()+e);break;case"year":s.setFullYear(s.getFullYear()+e)}const l=s.getFullYear(),r=s.getMonth()+1<10?"0"+(s.getMonth()+1):s.getMonth()+1,n=s.getDate()<10?"0"+s.getDate():s.getDate();return{fullDate:l+"-"+r+"-"+n,year:l,month:r,date:n,day:s.getDay()}}_getLastMonthDays(t,e){let a=[];for(let s=t;s>0;s--){const t=new Date(e.year,e.month-1,1-s).getDate();a.push({date:t,month:e.month-1,lunar:this.getlunar(e.year,e.month-1,t),disable:!0})}return a}_currentMonthDys(t,e){let a=[],s=this.date.fullDate;for(let l=1;l<=t;l++){let t=e.year+"-"+(e.month,e.month+"-")+(l<10?"0"+l:l),r=s===t,n=this.selected&&this.selected.find((e=>{if(this.dateEqual(t,e.date))return e})),h=!0,i=!0;this.startDate&&(h=this.dateCompare(this.startDate,t)),this.endDate&&(i=this.dateCompare(t,this.endDate));let u=this.multipleStatus.data,D=!1,o=-1;this.range&&(u&&(o=u.findIndex((e=>this.dateEqual(e,t)))),-1!==o&&(D=!0));let g={fullDate:t,year:e.year,date:l,multiple:!!this.range&&D,beforeMultiple:this.dateEqual(this.multipleStatus.before,t),afterMultiple:this.dateEqual(this.multipleStatus.after,t),month:e.month,lunar:this.getlunar(e.year,e.month,l),disable:!(h&&i),isDay:r};n&&(g.extraInfo=n),a.push(g)}return a}_getNextMonthDays(t,e){let a=[];for(let s=1;s<t+1;s++)a.push({date:s,month:Number(e.month)+1,lunar:this.getlunar(e.year,Number(e.month)+1,s),disable:!0});return a}getInfo(t){t||(t=new Date);return this.canlender.find((e=>e.fullDate===this.getDate(t).fullDate))}dateCompare(t,e){return(t=new Date(t.replace("-","/").replace("-","/")))<=(e=new Date(e.replace("-","/").replace("-","/")))}dateEqual(t,e){return t=new Date(t.replace("-","/").replace("-","/")),e=new Date(e.replace("-","/").replace("-","/")),t.getTime()-e.getTime()==0}geDateAll(t,e){var a=[],s=t.split("-"),l=e.split("-"),r=new Date;r.setFullYear(s[0],s[1]-1,s[2]);var n=new Date;n.setFullYear(l[0],l[1]-1,l[2]);for(var h=r.getTime()-864e5,i=n.getTime()-864e5,u=h;u<=i;)u+=864e5,a.push(this.getDate(new Date(parseInt(u))).fullDate);return a}getlunar(e,a,s){return t.calendar.solar2lunar(e,a,s)}setSelectInfo(t,e){this.selected=e,this._getWeek(t)}setMultiple(t){let{before:e,after:a}=this.multipleStatus;this.range&&(e&&a?(this.multipleStatus.before="",this.multipleStatus.after="",this.multipleStatus.data=[]):e?(this.multipleStatus.after=t,this.dateCompare(this.multipleStatus.before,this.multipleStatus.after)?this.multipleStatus.data=this.geDateAll(this.multipleStatus.before,this.multipleStatus.after):this.multipleStatus.data=this.geDateAll(this.multipleStatus.after,this.multipleStatus.before)):this.multipleStatus.before=t,this._getWeek(t))}_getWeek(t){const{year:e,month:a}=this.getDate(t);let s=new Date(e,a-1,1).getDay(),l=new Date(e,a,0).getDate(),r={lastMonthDays:this._getLastMonthDays(s,this.getDate(t)),currentMonthDys:this._currentMonthDys(l,this.getDate(t)),nextMonthDays:[],weeks:[]},n=[];const h=42-(r.lastMonthDays.length+r.currentMonthDys.length);r.nextMonthDays=this._getNextMonthDays(h,this.getDate(t)),n=n.concat(r.lastMonthDays,r.currentMonthDys,r.nextMonthDays);let i={};for(let u=0;u<n.length;u++)u%7==0&&(i[parseInt(u/7)]=new Array(7)),i[parseInt(u/7)][u%7]=n[u];this.canlender=n,this.weeks=i}};
