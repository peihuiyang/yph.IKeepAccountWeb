"use strict";var e=require("../../common/vendor.js"),a=require("../../common/js/tools.js"),t=require("../../common/js/request.js");const o={components:{fuiEmpty:()=>"../../components/firstui/fui-empty/fui-empty.js"},data:()=>({userInfo:e.index.getStorageSync("user_info"),isDataEmpty:!0,swiperightoptions:[{text:"修改",style:{backgroundColor:"#007aff"}},{text:"删除",style:{backgroundColor:"#dd524d"}}],plandaterange:[Date.now(),Date.now()+5e8],queryBill:{pageIndex:1,pageSize:10,year:(new Date).getFullYear(),month:(new Date).getMonth()+1,reType:2,startTime:a.tools.formatDate01((new Date).getFullYear(),(new Date).getMonth()+1,1),endTime:a.tools.formatDate(new Date),remark:""},reTypes:[{text:"全部",value:2},{text:"收入",value:0},{text:"支出",value:1}],billDatas:[],loadStatus:"more",moreContentText:{contentdown:"加载更多",contentrefresh:"加载中",contentnomore:"我是有底线的"},accountFormData:{id:"",money:0,reType:1,keepTime:"",remark:"",planId:"",payType:"",purpose:""},billReTypes:[{text:"收入",value:0},{text:"支出",value:1}],planIdRange:[],purposeRange:[],payTypeRange:[],rules:{keepTime:{rules:[{required:!0,errorMessage:"请选择日期"}]},purpose:{rules:[{required:!0,errorMessage:"请选择账单分类"}]},payType:{rules:[{required:!0,errorMessage:"请选择支付方式"}]},money:{rules:[{format:"number",errorMessage:"金额只能输入数字"}]},remark:{rules:[{required:!0,errorMessage:"备注不能为空"}]}},content:[{iconPath:"/static/images/icon/backtop.png",selectedIconPath:"/static/images/icon/backtop.png",text:"置顶",active:!1}],showFabBtn:!1}),onLoad(){this.showData()},onPageScroll(e){e.scrollTop>=880?this.showFabBtn=!0:this.showFabBtn=!1},onPullDownRefresh(){this.showData(),setTimeout((function(){e.index.stopPullDownRefresh()}),1e3)},methods:{swipeBindClick(e,a){"修改"===e.content.text?this.modifyBill(a):"删除"===e.content.text&&this.deleteBill(a.id)},fabtrigger(e){"置顶"===e.item.text&&this.backTop()},backTop(){e.index.pageScrollTo({scrollTop:0,duration:100})},clickLoadMore(e){var a=this;"more"===e.detail.status&&(a.loadStatus="loading",a.queryBill.pageIndex=a.queryBill.pageIndex+1,console.log(a.queryBill),a.searchBill(a.queryBill.pageIndex))},modifyBill(e){var a=this;a.accountFormData={id:e.id,money:e.money,reType:e.reType,keepTime:e.keepTime.substring(0,10),remark:e.remark,planId:e.planId,payType:e.payType,purpose:e.purpose},a.getPurpose(),a.getPayType(),a.getPlanData(),a.$refs.billpopup.open()},deleteBill(a){var o=this;e.index.request({url:"/api/ika/v1/accountrecord/delete?id="+a,method:"DELETE",timeout:3e3,header:{Authorization:o.userInfo.token},success:a=>{1===a.data.status?(e.index.showToast({title:a.data.message,icon:"success",duration:2e3}),o.showData(),t.request.getMonthBillCount(!0)):e.index.showToast({title:a.data.message,icon:"error",duration:2e3})},fail:a=>{e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3})}})},showData(){this.barRightClick(),this.billDatas.length>0&&(this.isDataEmpty=!1)},barLeftClick(){this.$refs.popup.open()},changeDate(e){this.queryBill.startTime=e[0],this.queryBill.endTime=e[1],this.queryBill.year=new Date(e[0]).getFullYear(),this.queryBill.month=new Date(e[0]).getMonth()+1},barRightClick(){this.searchBill(1)},searchBill(a){var t=this;t.queryBill.pageIndex=a,e.index.request({url:"/api/ika/v1/accountrecord/findbypage",method:"POST",timeout:3e3,header:{Authorization:t.userInfo.token},data:t.queryBill,success:o=>{1===o.data.status?(1===a?(t.billDatas=[],t.billDatas=o.data.data.accounts):o.data.data.accounts.forEach(((e,a)=>{t.billDatas.push(e)})),o.data.data.totalNum>0&&(t.isDataEmpty=!1),o.data.data.pageSize*o.data.data.pageIndex>=o.data.data.totalNum?t.loadStatus="no-more":t.loadStatus="more",t.$refs.popup.close()):(e.index.showToast({title:o.data.message,icon:"error",duration:2e3}),t.loadStatus="more")},fail:a=>{e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3}),t.loadStatus="more"}})},getPurpose(){const a=e.index.getStorageSync("purpose_data");null!==a&&""!==a||(t.request.getPurpose(),a=e.index.getStorageSync("purpose_data")),this.purposeRange=a},getPayType(){const a=e.index.getStorageSync("paytype_data");null!==a&&""!==a||(t.request.getPayType(),a=e.index.getStorageSync("paytype_data")),this.payTypeRange=a},submitAccount(a){var o=this;o.$refs[a].validate().then((a=>{e.index.showLoading({title:"数据上传中……"}),e.index.request({url:"/api/ika/v1/accountrecord/modify",method:"POST",timeout:3e3,header:{Authorization:o.userInfo.token},data:o.accountFormData,success:a=>{e.index.hideLoading(),1===a.data.status?(e.index.showToast({title:a.data.message,icon:"success",duration:1e3}),o.$refs.billpopup.close(),o.showData(),t.request.getMonthBillCount(!0)):e.index.showToast({title:a.data.message,icon:"error",duration:2e3})},fail:a=>{e.index.hideLoading(),e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3})}})})).catch((a=>{e.index.showToast({title:a[0].errorMessage,icon:"fail",duration:2e3})}))},changeBillDate(e){this.accountFormData.keepTime=e},getPlanData(){var a=this;e.index.request({url:"/api/ika/v1/plan/getnotfinish",method:"GET",timeout:3e3,header:{Authorization:a.userInfo.token},success:t=>{1===t.data.status?a.planIdRange=t.data.data:e.index.showToast({title:t.data.message,icon:"error",duration:2e3})},fail:a=>{e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3})}})},changePlanId(e){this.accountFormData.planId=e}}};if(!Array){(e.resolveComponent("uni-icons")+e.resolveComponent("uni-nav-bar")+e.resolveComponent("fui-empty")+e.resolveComponent("uni-swipe-action-item")+e.resolveComponent("uni-swipe-action")+e.resolveComponent("uni-load-more")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-popup")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-fab"))()}Math||((()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../uni_modules/uni-nav-bar/components/uni-nav-bar/uni-nav-bar.js")+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action-item/uni-swipe-action-item.js")+(()=>"../../uni_modules/uni-swipe-action/components/uni-swipe-action/uni-swipe-action.js")+(()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../uni_modules/uni-fab/components/uni-fab/uni-fab.js"))();var n=e._export_sfc(o,[["render",function(a,t,o,n,i,r){return e.e({a:e.p({type:"search",size:"18",color:"#999"}),b:i.queryBill.remark,c:e.o((e=>i.queryBill.remark=e.detail.value)),d:e.o(r.barLeftClick),e:e.o(r.barRightClick),f:e.p({leftText:"按条件",leftIcon:"arrowdown",rightText:"搜索",rightIcon:"search"}),g:i.isDataEmpty},i.isDataEmpty?{h:e.p({src:"../../static/images/image/img_data_3x.png",title:"暂无数据",descr:"请在首页先添加账单！"})}:{i:e.f(i.billDatas,((a,t,o)=>({a:e.t(a.remark),b:e.t(a.purpose_Desc),c:e.t(a.keepTime.substring(0,10)),d:e.t(1===a.reType?"-":""),e:e.t(a.money),f:e.n(0===a.reType?"billprice":"billprice1"),g:a.id,h:e.o((e=>r.swipeBindClick(e,a))),i:"9f18af38-4-"+o+",9f18af38-3-"+o,j:"9f18af38-3-"+o}))),j:e.p({"right-options":i.swiperightoptions,show:"none","auto-close":!0}),k:e.o(r.clickLoadMore),l:e.p({color:"#007AFF",status:i.loadStatus,iconType:"auto","content-text":i.moreContentText})},{m:e.o((e=>i.queryBill.reType=e)),n:e.p({mode:"button",localdata:i.reTypes,modelValue:i.queryBill.reType}),o:e.p({label:"收支"}),p:e.o(r.changeDate),q:e.o((e=>i.plandaterange=e)),r:e.p({type:"daterange",modelValue:i.plandaterange}),s:e.p({label:"日期",name:"dateform"}),t:e.p({modelValue:i.queryBill,name:"queryBill"}),v:e.o(((...e)=>r.barRightClick&&r.barRightClick(...e))),w:e.sr("popup","9f18af38-6"),x:e.p({type:"center","background-color":"#fff"}),y:e.o((e=>i.accountFormData.money=e)),z:e.p({placeholder:"请输入金额",modelValue:i.accountFormData.money}),A:e.p({label:"金额",required:!0,name:"money"}),B:e.o((e=>i.accountFormData.reType=e)),C:e.p({mode:"button",localdata:i.billReTypes,modelValue:i.accountFormData.reType}),D:e.p({label:"收支",required:!0}),E:e.o(r.changeBillDate),F:e.o((e=>i.accountFormData.keepTime=e)),G:e.p({type:"date","clear-icon":!1,modelValue:i.accountFormData.keepTime}),H:e.p({label:"日期",required:!0,name:"keepTime"}),I:e.o((e=>i.accountFormData.purpose=e)),J:e.p({localdata:i.purposeRange,modelValue:i.accountFormData.purpose}),K:e.p({label:"账单分类",required:!0,name:"purpose"}),L:e.o((e=>i.accountFormData.payType=e)),M:e.p({localdata:i.payTypeRange,modelValue:i.accountFormData.payType}),N:e.p({label:"支付方式",required:!0,name:"payType"}),O:e.o(r.changePlanId),P:e.o((e=>i.accountFormData.planId=e)),Q:e.p({localdata:i.planIdRange,modelValue:i.accountFormData.planId}),R:e.p({label:"计划",name:"planId"}),S:e.o((e=>i.accountFormData.remark=e)),T:e.p({type:"textarea",placeholder:"请输入备注",modelValue:i.accountFormData.remark}),U:e.p({label:"备注",required:!0,name:"remark"}),V:e.sr("valiForm","9f18af38-13,9f18af38-12"),W:e.p({rules:i.rules,modelValue:i.accountFormData}),X:e.o((e=>r.submitAccount("valiForm"))),Y:e.sr("billpopup","9f18af38-12"),Z:e.p({type:"right","background-color":"#fff"}),aa:i.showFabBtn},i.showFabBtn?{ab:e.o(r.fabtrigger),ac:e.p({content:i.content,horizontal:"right",vertical:"bottom"})}:{})}]]);o.__runtimeHooks=1,qa.createPage(n);
