"use strict";var e=require("../../../common/vendor.js"),a=require("../../../common/js/mylogin.js");const t={data:()=>({userInfo:e.index.getStorageSync("user_info"),items:["月计划","周计划","年计划"],current:0,plans:[],pageIndex:1,numTotal:5,pageSize:5,horizontal:"right",vertical:"bottom",pattern:{color:"#7A7E83",backgroundColor:"#fff",selectedColor:"#007AFF",buttonColor:"#007aFF",iconColor:"#fff"},plandaterange:[Date.now(),Date.now()+5e8],planTypes:[{text:"月计划",value:0},{text:"周计划",value:1},{text:"年计划",value:2}],reTypes:[{text:"收入",value:0},{text:"支出",value:1}],parentIdRange:[],planFormData:{name:"",amountMoney:"",remark:"",planType:0,reType:0,startTime:"",endTime:"",parentId:""},rules:{name:{rules:[{required:!0,errorMessage:"计划不能为空"}]},amountMoney:{rules:[{format:"number",errorMessage:"金额只能输入数字"}]}}}),onLoad(){a.mylogin.checkLogin(!0),this.getPlanPage(1)},methods:{fabClick(){this.$refs.popup.open(),this.planFormData.startTime=this.plandaterange[0],this.planFormData.endTime=this.plandaterange[1]},onClickItem(e){this.current!==e.currentIndex&&(this.current=e.currentIndex,this.getPlanPage(1))},changePage(e){this.getPlanPage(e.current)},getPlanPage(a){var t=this;e.index.showLoading({title:"数据查询中……"}),t.plans=[],e.index.request({url:"/api/ika/v1/plan/findbypage",method:"POST",timeout:3e3,header:{Authorization:t.userInfo.token},data:{uId:t.userInfo.id,pageIndex:a,pageSize:5,planType:t.current},success:a=>{if(e.index.hideLoading(),1===a.data.status){t.numTotal=a.data.data.totalNum;for(var n=a.data.data.planList,o=0;o<n.length;o++)t.plans.push(n[o])}else e.index.showToast({title:a.data.message,icon:"error",duration:2e3})},fail:a=>{e.index.hideLoading(),e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3})}})},submitPlan(a){var t=this;t.$refs[a].validate().then((a=>{e.index.request({url:"/api/ika/v1/plan/add",method:"POST",timeout:3e3,header:{Authorization:t.userInfo.token},data:t.planFormData,success:a=>{console.log(a.data),1===a.data.status?(e.index.showToast({title:a.data.message,icon:"success",duration:1e3}),t.$refs.popup.close(),t.getPlanPage(1)):e.index.showToast({title:a.data.message,icon:"error",duration:2e3})},fail:a=>{e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3})}})})).catch((a=>{e.index.showToast({title:a[0].errorMessage,icon:"fail",duration:2e3}),console.log("err",a)}))},selectPlanDate(e){this.planFormData.startTime=e[0],this.planFormData.endTime=e[1]},getParentData(){var a=this;e.index.request({url:"/api/ika/v1/plan/getnotfinish",method:"GET",timeout:3e3,header:{Authorization:a.userInfo.token},success:t=>{console.log(t.data),1===t.data.status?a.parentIdRange=t.data.data:e.index.showToast({title:t.data.message,icon:"error",duration:2e3})},fail:a=>{e.index.showToast({title:a.errMsg,icon:"fail",duration:2e3})}})},changeParentId(e){this.planFormData.parentId=e}}};if(!Array){(e.resolveComponent("uni-segmented-control")+e.resolveComponent("uni-tag")+e.resolveComponent("uni-card")+e.resolveComponent("uni-pagination")+e.resolveComponent("uni-fab")+e.resolveComponent("uni-easyinput")+e.resolveComponent("uni-forms-item")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-data-select")+e.resolveComponent("uni-forms")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../../uni_modules/uni-segmented-control/components/uni-segmented-control/uni-segmented-control.js")+(()=>"../../../uni_modules/uni-tag/components/uni-tag/uni-tag.js")+(()=>"../../../uni_modules/uni-card/components/uni-card/uni-card.js")+(()=>"../../../uni_modules/uni-pagination/components/uni-pagination/uni-pagination.js")+(()=>"../../../uni_modules/uni-fab/components/uni-fab/uni-fab.js")+(()=>"../../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms-item/uni-forms-item.js")+(()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../../uni_modules/uni-data-select/components/uni-data-select/uni-data-select.js")+(()=>"../../../uni_modules/uni-forms/components/uni-forms/uni-forms.js")+(()=>"../../../uni_modules/uni-popup/components/uni-popup/uni-popup.js"))();var n=e._export_sfc(t,[["render",function(a,t,n,o,r,i){return e.e({a:e.o(i.onClickItem),b:e.p({current:r.current,values:r.items}),c:0===r.current},0===r.current?{d:e.f(r.plans,((a,t,n)=>({a:"7d6189af-2-"+n+",7d6189af-1-"+n,b:e.p({mark:!0,text:a.amountMoney,type:0===a.reType?"primary":"error",size:"mini"}),c:e.t(a.remark),d:"7d6189af-1-"+n,e:e.p({title:a.name,"sub-title":a.code,extra:a.reType_Desc})}))),e:e.o(i.changePage),f:e.p({"show-icon":!0,title:"分页",total:r.numTotal,current:r.pageIndex,pageSize:r.pageSize})}:{},{g:1===r.current},1===r.current?{h:e.f(r.plans,((a,t,n)=>({a:"7d6189af-5-"+n+",7d6189af-4-"+n,b:e.p({mark:!0,text:a.amountMoney,type:0===a.reType?"primary":"error",size:"mini"}),c:e.t(a.remark),d:"7d6189af-4-"+n,e:e.p({title:a.name,"sub-title":a.code,extra:a.reType_Desc})}))),i:e.o(i.changePage),j:e.p({"show-icon":!0,title:"分页",total:r.numTotal,current:r.pageIndex,pageSize:r.pageSize})}:{},{k:2===r.current},2===r.current?{l:e.f(r.plans,((a,t,n)=>({a:"7d6189af-8-"+n+",7d6189af-7-"+n,b:e.p({mark:!0,text:a.amountMoney,type:0===a.reType?"primary":"error",size:"mini"}),c:e.t(a.remark),d:"7d6189af-7-"+n,e:e.p({title:a.name,"sub-title":a.code,extra:a.reType_Desc})}))),m:e.o(i.changePage),n:e.p({"show-icon":!0,title:"分页",total:r.numTotal,current:r.pageIndex,pageSize:r.pageSize})}:{},{o:e.sr("fab","7d6189af-10"),p:e.o(i.fabClick),q:e.p({pattern:r.pattern,horizontal:r.horizontal,popMenu:"true",vertical:r.vertical}),r:e.o((e=>r.planFormData.name=e)),s:e.p({placeholder:"请输入计划名",modelValue:r.planFormData.name}),t:e.p({label:"计划名",required:!0,name:"name"}),v:e.o((e=>r.planFormData.reType=e)),w:e.p({mode:"button",localdata:r.reTypes,modelValue:r.planFormData.reType}),x:e.p({label:"收支",required:!0}),y:e.o((e=>r.planFormData.planType=e)),z:e.p({mode:"button",localdata:r.planTypes,modelValue:r.planFormData.planType}),A:e.p({label:"计划类型",required:!0}),B:e.o((e=>r.planFormData.amountMoney=e)),C:e.p({placeholder:"请输入金额",modelValue:r.planFormData.amountMoney}),D:e.p({label:"金额",required:!0,name:"amountMoney"}),E:e.o(i.selectPlanDate),F:e.o((e=>r.plandaterange=e)),G:e.p({type:"daterange",modelValue:r.plandaterange}),H:e.p({label:"日期",required:!0,name:"dateform"}),I:e.o(i.getParentData),J:e.o(i.changeParentId),K:e.o((e=>r.planFormData.parentId=e)),L:e.p({localdata:r.parentIdRange,modelValue:r.planFormData.parentId}),M:e.p({label:"父级",name:"parentId"}),N:e.o((e=>r.planFormData.remark=e)),O:e.p({type:"textarea",placeholder:"请输入备注",modelValue:r.planFormData.remark}),P:e.p({label:"备注",name:"remark"}),Q:e.sr("valiForm","7d6189af-12,7d6189af-11"),R:e.p({rules:r.rules,modelValue:r.planFormData}),S:e.o((e=>i.submitPlan("valiForm"))),T:e.sr("popup","7d6189af-11"),U:e.p({type:"bottom","background-color":"#fff"})})}]]);qa.createPage(n);
